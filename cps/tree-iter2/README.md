Tree traversal with generic macros.
